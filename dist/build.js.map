{"version":3,"file":"build.js","sources":["../src/Evented.js","../src/settings.js","../src/dataUtils.js","../src/PeerBinary.js","../src/defaultFirebase.js","../src/P2PServer.js","../src/P2PClient.js","../src/peerBinary.js"],"sourcesContent":["\nexport class Evented {\n  constructor() {\n    this.events = {};\n  }\n\n  on(eventName, callback) {\n    if (typeof callback !== \"function\") return;\n    if (! this.events.hasOwnProperty(eventName)) {\n      this.events[eventName] = [];\n    }\n    this.events[eventName].push(callback);\n  }\n\n  off(eventName, callback) {\n    if (this.events.hasOwnProperty(eventName)) {\n      if (typeof callback === \"function\") {\n        //_.without(this.events[eventName], callback);\n        this.events = this.events.filter( function(x){\n            if ( x != this.events[eventName]) { return x }\n        })\n      } else {\n        delete this.events[eventName];\n      }\n    }\n  }\n\n  fire(eventName, argument) {\n    //_.each(this.events[eventName], (cb) => setTimeout(() => cb(argument)));\n    if (this.events[eventName]) {\n      for (var cb of this.events[eventName]) {\n        setTimeout(() => cb(argument))\n      }\n    }\n  }\n\n  fireAll(argument) {\n    for (var k in this.events) {\n      this.fire(k, argument);\n    }\n  }\n}\n","export var settings = {\n  // Get a reference to the database service\n\n  // Was having a bug where the WIFI router would crash if the chunk size was bigger than 2^10\n  CHUNK_SIZE: Math.pow(2, 10), // size in bytes of the chunks. 2^16 is just under the limit in chrome.\n  ICE_SERVERS: [\n    {\n      url: 'stun:23.21.150.121',\n      urls: 'stun:23.21.150.121',\n    },\n    {\n      url: 'turn:global.turn.twilio.com:3478?transport=udp',\n      username:\n        '508d1e639868dc17f5da97a75b1d3b43bf2fc6d11e4e863678501db568b5665c',\n      credential: 'W5GTdhQQ6DqOD7k6bS8+xZVNQXm+fgLXSEQpN8bTe70=',\n      urls: 'turn:global.turn.twilio.com:3478?transport=udp',\n    },\n  ],\n  POLLING_FREQUENCY: 15000,\n  debug: false,\n};\n","import { Evented } from \"./Evented.js\";\nimport { settings } from \"./settings.js\";\nimport * as msgpacklite from \"msgpack-lite/dist/msgpack.min.js\";\n\nvar msgPack = msgpacklite.default;\n\nvar drawingCanvas; // this is a canvas used by imageToBlob\n\nconst MAX_RECURSIVE_DEPTH = 10;\n//\n// @param  {Function} callback []\n//\nexport async function generateWebRTCpayload(obj) {\n  let deBlobbed = await recursivelyEncodeBlobs(obj);\n  let result = _generateWebRTCpayload(deBlobbed);\n  return result;\n}\nexport function deBlob(obj) {\n  return new Promise((resolve, reject) => {\n    var reader = new FileReader();\n    reader.addEventListener(\"loadend\", function() {\n      const view = new Int8Array(reader.result);\n      let descript = { isBlob: true, type: obj.type };\n      if (obj.lastModified) descript.lastModified = obj.lastModified;\n      if (obj.name) descript.name = obj.name;\n      if (obj.size) descript.size = obj.size;\n      if (obj.exif) descript.exif = obj.exif;\n      descript.view = view; // _generateWebRTCpayload(view, descript);\n      resolve(descript);\n    });\n    reader.readAsArrayBuffer(obj);\n  });\n}\n\nexport async function recursivelyEncodeBlobs(obj, depth = 0) {\n  if (depth > MAX_RECURSIVE_DEPTH) {\n    throw (\"max depth reached\", depth);\n  }\n  if (obj.constructor == File || obj.constructor == Blob) {\n    return await deBlob(obj);\n  } else if (obj.constructor == Object) {\n    let res = {};\n    for (var i in obj) {\n      res[i] = await recursivelyEncodeBlobs(obj[i], depth + 1);\n    }\n    return res;\n  }\n  return obj;\n}\n\nexport async function recursivelyDecodeBlobs(obj, depth = 0) {\n  if (depth > MAX_RECURSIVE_DEPTH) {\n    throw (\"max depth reached\", depth);\n  }\n  if (obj.constructor == Object && obj.type && obj.isBlob) {\n    let descript = {};\n    for (var i in obj) {\n      if (i !== \"view\" && i != \"chunks\") {\n        descript[i] = obj[i];\n      }\n    }\n    let val1 = new Blob([obj.view], descript);\n    return val1;\n  } else if (obj.constructor == Object) {\n    let res = {};\n    for (var i in obj) {\n      res[i] = await recursivelyDecodeBlobs(obj[i], depth + 1);\n    }\n    return res;\n  }\n  return obj;\n}\n\nexport async function _generateWebRTCpayload(obj, headerOpt = {}) {\n  //console.time('generateWebRTCpayload')\n  let bin = msgPack.encode(obj);\n  var header = Object.assign(\n    {\n      iAmAHeader: true,\n      payloadID: Math.floor(Math.random() * 100000000)\n    },\n    headerOpt\n  );\n  var chunks = arrayBufferToChunks(bin, header.payloadID);\n  header.chunkCount = chunks.length;\n  //console.timeEnd('generateWebRTCpayload')\n  return { header: msgPack.encode(header), chunks: chunks };\n}\n\nexport function arrayBufferToChunks(buff, payloadID) {\n  //console.time('chunks')\n  var result = [];\n  var wholeshebang = new Uint8Array(buff);\n  var count = 0;\n  payloadID = payloadID || Math.floor(Math.random() * 100000000);\n  for (var i = 0; i < buff.byteLength; i += settings.CHUNK_SIZE) {\n    var chunksize = Math.min(buff.byteLength - i, settings.CHUNK_SIZE);\n    var chunk = wholeshebang.slice(i, i + chunksize);\n    var id = count; //new Uint8Array(idSize);\n    let chbin = msgPack.encode({ payloadID: payloadID, id: id, chunk: chunk });\n    result.push(chbin);\n    count++;\n  }\n  //console.timeEnd('chunks')\n  //console.log(`generated ${count} chunks`)\n  return result;\n}\n\nexport function imageToBlob(img, cb) {\n  if (!drawingCanvas) {\n    drawingCanvas = document.createElement(\"canvas\");\n  }\n  drawingCanvas.width = img.width;\n  drawingCanvas.height = img.height;\n  drawingCanvas.getContext(\"2d\").drawImage(img, 0, 0, img.width, img.height);\n  drawingCanvas.toBlob(function(blob) {\n    cb(blob);\n  });\n}\n","import * as Peer2 from 'simple-peer/simplepeer.min.js';\nimport { generateWebRTCpayload, recursivelyDecodeBlobs } from './dataUtils.js';\n// import adapter from \"webrtc-adapter/src/js/adapter_core.js\";\nimport * as msgpacklite from 'msgpack-lite/dist/msgpack.min.js';\n\nvar msgPack = msgpacklite.default;\nvar Peer = Peer2.default;\nwindow.simpPeer = Peer;\nconsole.log('msg pack', msgpacklite);\n\nexport class PeerBinary extends Peer {\n  constructor(options) {\n    //console.log('PeerBinary contructor called')\n    super(options);\n    this._registerDataMessage();\n    this.unchunker = new UnChunker(); //\n    this.unchunker.onData = val => {\n      this.emit('dataBig', val);\n    };\n    this.peerID = options.peerID;\n  }\n\n  //want to overide these 2 functions I think.\n  _registerDataMessage(event) {\n    this.on('data', data => {\n      //when its done with a complete chunk, call this.emit('dataBig', completed)\n      this.unchunker.registerChunk(data);\n    });\n  }\n\n  async sendBig(chunk) {\n    let stuff = await generateWebRTCpayload(chunk);\n    this.send(stuff.header);\n    for (var i in stuff.chunks) {\n      var ch = stuff.chunks[i];\n      this.send(ch);\n    }\n  }\n}\n\n//\n// Takes a bunch of possibly out of order shunks and assembles them into one\n//\nexport class UnChunker {\n  constructor() {\n    this.payloads = {};\n    this.payloadCount = 0;\n    this.onData = function(val) {\n      console.log('default, data is ready:', val);\n    };\n  }\n\n  registerChunk(msg) {\n    var header = this.parseHeader(msg);\n    if (header) {\n      this._newPayload(header.payloadID, header);\n    } else if (this._isChunk(msg)) {\n      //the is a chunk hopefully\n      try {\n        let val = msgPack.decode(msg);\n        this._appendToPayload(val);\n        //this.emit('dataBig', val)\n        if (this._isPayloadReady(val.payloadID)) {\n          this._assembleChunks(val.payloadID, result => {\n            this.onData(result);\n            return result;\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        console.error('val:', msg);\n      }\n    } else {\n      console.warn('not my type', msg);\n      //console.warn(this._ab2str(msg))\n    }\n    return null;\n  }\n\n  _newPayload(id, header) {\n    this.payloads[id] = Object.assign(header, {\n      count: header.chunkCount,\n      chunks: [],\n      lastUpdate: new Date(),\n    });\n    this.payloadCount++;\n  }\n\n  _appendToPayload(chunk) {\n    var pl = this.payloads[chunk.payloadID];\n    pl.lastUpdate = new Date();\n    pl.chunks.push(chunk);\n  }\n\n  async _assembleChunks(payloadID, cb) {\n    var pl = this.payloads[payloadID];\n    pl.chunks.sort(function(a, b) {\n      return Number(a.id) - Number(b.id);\n    });\n    var totalSize = 0;\n    for (var i = 0; i < pl.chunks.length; i++) {\n      totalSize += pl.chunks[i].chunk.length;\n    }\n    var result = new Uint8Array(totalSize);\n    var position = 0;\n    for (var i = 0; i < pl.chunks.length; i++) {\n      var ch = pl.chunks[i];\n      result.set(ch.chunk, position);\n      position += ch.chunk.length;\n    }\n    try {\n      let val1 = msgPack.decode(result);\n      let val2 = await recursivelyDecodeBlobs(val1);\n      cb(val2);\n      this._removePayload(payloadID);\n    } catch (err) {\n      console.error(err);\n      console.error('buffer', result);\n    }\n  }\n\n  _removePayload(id) {\n    delete this.payloads[id];\n    this.payloadCount--;\n  }\n\n  parseHeader(data) {\n    if (typeof data == 'object' && !(data instanceof Uint8Array)) {\n      if (data.chunkCount && data.chunkCount > 0) {\n        return data;\n      }\n    } else if (data.length && data.length < 4000) {\n      // might have been packed or something.\n      var json = msgPack.decode(data);\n      if (json) {\n        try {\n          if (json && json.iAmAHeader) {\n            return json;\n          }\n        } catch (er) {\n          // probably not a header. Not a big deal\n        }\n      }\n    }\n    return undefined;\n  }\n\n  _isChunk(msg) {\n    if (this.payloadCount <= 0) {\n      return false;\n    }\n    return msg instanceof Uint8Array || msg instanceof DataView;\n  }\n\n  _isPayloadReady(id) {\n    var pl = this.payloads[id];\n    if (pl.chunks.length == pl.count) {\n      return true;\n    }\n    return false;\n  }\n}\n","import * as firebase2 from \"firebase/dist/index.esm\";\nexport var firebase = firebase2.default;\n\nvar defaultFBConfig = {\n  apiKey: \"AIzaSyBEbLlzJmmOC7CVfbeZs_HQBWia_xSb4sA\",\n  authDomain: \"https://torrid-torch-716.firebaseio.com/\",\n  databaseURL: \"https://torrid-torch-716.firebaseio.com/\",\n  projectId: \"torrid-torch-716\"\n};\n\nvar database;\n\nexport function getDatabase() {\n  if (database) return database;\n  firebase.initializeApp(defaultFBConfig);\n  database = firebase\n    .database()\n    .ref(\"/\")\n    .child(\"peers\");\n  return database;\n}\n","import { PeerBinary } from './PeerBinary.js';\nimport { settings } from './settings.js';\nimport { Evented } from './Evented.js';\nimport { getDatabase } from './defaultFirebase.js';\nimport * as firebase2 from 'firebase/dist/index.esm';\nvar firebase = firebase2.default;\n\nexport class Channel {\n  constructor(fbref, peer) {\n    this.outRef = fbref.child('fromServer'); //firebase\n    this.inRef = fbref.child('fromClient');\n    this.peer = peer; // simple-peer\n  }\n\n  destroy() {\n    this.outRef.off();\n    this.inRef.off();\n    this.peer.destroy();\n  }\n}\n\nexport class P2PServer extends Evented {\n  constructor(options = {}) {\n    super(); //no idea what this does\n    console.assert(\n      options.iceServers,\n      'Server: no ice servers yet. Using defaults'\n    );\n    this.MAX_CONNECTIONS = 20;\n    this.debug = false;\n    this.isListening = false;\n    this.id = 'server' + Math.floor(Math.random() * 100000);\n    this.stream = undefined;\n    this.iceServers =\n      options.iceServers || options.ICE_SERVERS || settings.ICE_SERVERS;\n    this.database;\n    this.POLLING_FREQUENCY =\n      options.POLLING_FREQUENCY || settings.POLLING_FREQUENCY;\n    Object.assign(this, options);\n    if (options.database) {\n      this.database = options.database;\n    } else {\n      this.database = getDatabase();\n    }\n    if (this.debug) console.log(this.id);\n    if (!options.dontCallInitYet) {\n      this.init();\n    }\n  }\n\n  init() {\n    var fbref = this.database;\n    this.userRef = fbref.child(this.id);\n    this.updateRef = this.userRef.child('lastUpdate');\n    this.userRef.onDisconnect().remove();\n    this.updateRef.set(firebase.database.ServerValue.TIMESTAMP);\n    this.channelRef = this.userRef.child('channels');\n    if (this.stream) {\n      this.userRef.child('isStream').set(true);\n    }\n    this.channelRef.set([]);\n    this.connections = [];\n    this._intervalID = setInterval(() => {\n      this.fire('updateTimeStamp', undefined);\n      this._updateOnFireBase();\n    }, this.POLLING_FREQUENCY);\n    this.listenToChannels();\n    this.isListening = true;\n    this.fire('init', undefined);\n  }\n\n  _updateOnFireBase() {\n    // one may want to overwrite this\n    this.updateRef.set(firebase.database.ServerValue.TIMESTAMP);\n  }\n\n  sendToAll(data) {\n    for (var conx of this.connections) {\n      if (conx && conx.peer) {\n        try {\n          conx.peer.send.bind(conx.peer)(data);\n        } catch (err) {\n          console.error(err, 'Got an error, interrupted connection? ');\n        }\n      }\n    }\n  }\n\n  sendToAllBig(data) {\n    for (var conx of this.connections) {\n      if (conx && conx.peer) {\n        try {\n          conx.peer.sendBig.bind(conx.peer)(data);\n        } catch (err) {\n          console.error(err, 'Got an error, interrupted connection? ');\n        }\n      }\n    }\n  }\n\n  listenToChannels() {\n    // disabling no-loop-func because these loops are correct usage\n    // https://eslint.org/docs/rules/no-loop-func\n    // when a new channel is added, listen to it.\n    this.channelRef.on('child_added', ev => {\n      if (this.connections.length > this.MAX_CONNECTIONS) {\n        console.error(\n          'Too many connections. TODO:close/remove old stale connections'\n        );\n        return;\n      }\n      var val = ev.val();\n      if (this.debug) {\n        console.log(val, 'new child');\n      }\n      for (var i in val.fromClient) {\n        var sig = val.fromClient[i];\n        if (sig.type === 'offer') {\n          var mykey = ev.key;\n          var { peerID, myID } = sig;\n          var channel = new Channel(\n            this.channelRef.child(mykey),\n            this._makePeer(myID)\n          );\n          this.connections = [...this.connections, channel];\n          this.fire('addConnection', channel);\n\n          // on message through webRTC (simple-peer)\n          //eslint-disable-next-line no-loop-func\n          var answerSentYet = false;\n          channel.peer.on('signal', data => {\n            if (data.type === 'answer') {\n              if (answerSentYet) {\n                console.warn('Why am i trying to send multiple answers');\n              }\n              channel.outRef.push(data);\n              answerSentYet = true;\n            } else if (data.candidate) {\n              channel.outRef.push(data);\n            } else {\n              console.warn(data, 'unexpected message from WebRTC');\n            }\n          });\n\n          // on message through firebase\n          //eslint-disable-next-line no-loop-func\n          channel.inRef.on('child_added', ev2 => {\n            var val2 = ev2.val();\n            if (this.debug) {\n              console.log(val2, 'child_added -- firebase');\n            }\n            if (val2.candidate) {\n              if (this.debug) {\n                console.log(val2, 'server got candidate from firebase');\n              }\n              channel.peer.signal(val2);\n            } else if (val2.type === 'offer') {\n              channel.peer.signal(val2);\n            } else if (val2.type === 'answer') {\n              //ignore this. It was probably from me.\n            } else {\n              console.warn(val2, 'unexpected message from Firebase');\n            }\n          });\n        }\n      }\n    });\n  }\n\n  _makePeer(peerID) {\n    if (this.debug) console.log('_makePeer called with peerID: ', peerID);\n    this.fire('makePeer', undefined);\n    var myoptions = {\n      initiator: false,\n      trickle: true,\n      config: {\n        iceServers: this.iceServers,\n      },\n      peerID,\n    };\n    if (this.stream) myoptions.stream = this.stream;\n    var p = new PeerBinary(myoptions);\n    // fire events\n    p.on('error', err => {\n      console.error('server: error', err);\n      this.fire('error', { peer: p, err: err });\n    });\n    p.on('connect', () => {\n      if (this.debug) console.log('server: client connected');\n      this.fire('connect', { peer: p });\n    });\n    p.on('data', data => {\n      if (this.debug) console.log('server: server recieved some data: ', data);\n      this.fire('data', { peer: p, data: data });\n    });\n    p.on('close', () => {\n      if (this.debug) console.log('server: connection closed', p);\n      this._removeConnection(p);\n      this.fire('close', { peer: p });\n    });\n    p.on('dataBig', data => {\n      this.fire('dataBig', { peer: p, data: data });\n    });\n    p.on('stream', stream => {\n      if (this.debug) console.log('Server: connected to stream', stream);\n      this.fire('stream', { peer: p, stream: stream });\n    });\n    //TODO make it so server can register events that will get called on each individual connection\n    return p;\n  }\n\n  destroy() {\n    this.channelRef.remove();\n    this.updateRef.remove();\n    this.channelRef.off();\n    this.updateRef.off();\n    this.userRef.off();\n    this.isListening = false;\n    for (var x of this.connections) {\n      x.destroy();\n    }\n    this.fire(\"destroyed\", {});\n    this.connections = [];\n    clearInterval(this._intervalID);\n  }\n\n  _removeConnection(peer) {\n    var index = -1;\n    for (var i = 0; i < this.connections.length; i++) {\n      var conn = this.connections[i];\n      if (conn.peer == peer) {\n        if (this.debug) console.log('found my connection', i, conn);\n        index = i;\n      }\n    }\n    if (index >= 0) {\n      var conn = this.connections[index];\n      conn.destroy();\n      this.connections.splice(index, 1);\n      this.connections = [...this.connections];\n      this.fire('removeConnection', conn);\n      if (this.debug) console.log(this.connections);\n    }\n  }\n}\n","import { PeerBinary } from './PeerBinary.js';\nimport { settings } from './settings.js';\nimport { Evented } from './Evented.js';\nimport { getDatabase } from './defaultFirebase.js';\n\nexport class P2PClient extends Evented {\n  constructor(options = {}) {\n    super();\n    Object.assign(this, settings);\n    Object.assign(this, options);\n\n    this.iceServers =\n      options.iceServers || options.ICE_SERVERS || settings.ICE_SERVERS;\n\n    if (options.database) {\n      this.database = options.database;\n    } else {\n      this.database = getDatabase();\n    }\n\n    this.fbref = this.database;\n    this.connection = null;\n    this.channelRef = null;\n    this.stream = undefined;\n    this.isStream = true;\n    this.connectionCallbacks = [];\n    this.lastNegotiationState = undefined;\n  }\n\n  getPeerList(callback) {\n    this.fbref.once('value', ev => {\n      var val = ev.val();\n      this.peerList = val;\n      callback(null, val);\n    });\n  }\n\n  connectToPeerID(id, callback = () => {}) {\n    this.connectionCallbacks.push(callback);\n    this.getPeerList(() => {\n      var peer = this.peerList[id];\n      if (!peer) {\n        console.error('peer not defined. id:', id);\n        callback('peer not defined');\n      } else {\n        this.id = id;\n        this.serverRef = this.fbref.child(id);\n        this.serverRef.once('value', ev1 => {\n          var sval = ev1.val();\n          let pOpts = {\n            initiator: true,\n            trickle: true,\n            config: {\n              iceServers: this.iceServers,\n            },\n          };\n\n          if (sval.isStream || this.isStream) {\n            pOpts.stream = this.getMyStream();\n          }\n          var p = new PeerBinary(pOpts);\n          this.connection = p;\n          this._registerEvents();\n          p.on('signal', data => {\n            if (data.type == 'offer') {\n              this._createChannel(data);\n            } else if (data.candidate) {\n              if (this.debug) {\n                console.log('client recieved candidate from webrtc', data);\n              }\n              this.outRef.push(data);\n            } else {\n              console.warn(\n                'Client recieved unexpected signal through WebRTC:',\n                data\n              );\n            }\n          });\n          callback(null, this.connection);\n        });\n      }\n    });\n  }\n\n  getMyStream() {\n    if (this.stream) return this.stream;\n\n    // create fake stream if no stream specified, and the server is in streaming mode.\n    //    because, at the moment, simple-peer must have a stream from the initiator.\n    let fakeCanvas = document.createElement('canvas');\n    fakeCanvas.width = fakeCanvas.height = 1;\n    var fakeStream = fakeCanvas.captureStream();\n    return fakeStream;\n  }\n\n  disconnect(callback) {\n    callback =\n      callback ||\n      function() {\n        console.log('client disconnected from server', arguments);\n      };\n\n    if (this.serverRef) {\n      this.serverRef.off();\n    }\n    if (this.outRef) {\n      this.outRef.off();\n    }\n    if (this.inRef) {\n      this.inRef.off();\n    }\n    if (this.connection) {\n      this.connection.destroy(callback);\n    } else {\n      callback();\n    }\n    // QUESTION: should I also disconnect from the listeners to the events emitted by this class?\n    //     it would be this.off()\n  }\n\n  _createChannel(offer) {\n    //this.channelRef = this.serverRef.child('channels').push({offer:offer})\n    offer.peerID = this.peerID;\n    offer.myID = this.myID;\n    this.channelRef = this.serverRef.child('channels').push({\n      fromClient: [offer],\n    });\n    this.outRef = this.channelRef.child('fromClient');\n    this.inRef = this.channelRef.child('fromServer');\n    this.inRef.on('child_added', ev => {\n      if (this.debug) console.log(ev.val(), 'channel message, client');\n      var val = ev.val();\n      if (val.type === 'answer') {\n        setTimeout(() => {\n          let state = this.connection._pc.signalingState;\n          if (state == this.lastNegotiationState) {\n            if (this.debug)\n              console.log('signalstate. skip nested negotiations');\n            return;\n          }\n          if (this.debug) console.log('signal start negotiation');\n          this.lastNegotiationState = state;\n          if (this.debug) console.log('answer', this);\n          if (!this.connection.destroyed) this.connection.signal(val);\n        }, 50); // a slight delay helps establish connection, I think.\n      } else if (val.candidate) {\n        if (this.debug) console.log('client recieved candidate from firebase');\n        setTimeout(() => {\n          if (!this.connection.destroyed) this.connection.signal(val);\n        }, 50);\n      } else {\n        console.warn(val, 'Client recieved unexpected signal through Firebase');\n      }\n    });\n  }\n\n  _registerEvents() {\n    // fire events\n    this.connection.on('error', err => {\n      console.error('client: error', err);\n      this.fire('error', { peer: this.connection, err: err });\n    });\n    this.connection.on('connect', () => {\n      if (this.debug) console.log('client: client connected');\n      try {\n        for (var callback of this.connectionCallbacks) {\n          callback(null, this.connection);\n        }\n        this.connectionCallbacks = [];\n      } catch (err) {\n        console.warn(err);\n      }\n      this.fire('connect', { peer: this.connection });\n    });\n    this.connection.on('data', data => {\n      if (this.debug) console.log('server: server recieved some data: ', data);\n      this.fire('data', { peer: this.connection, data: data });\n    });\n    this.connection.on('close', data => {\n      if (this.debug) console.log('connection closed', this.connection);\n      this.fire('close', { peer: this.connection });\n    });\n    this.connection.on('dataBig', data => {\n      this.fire('dataBig', { peer: this.connection, data: data });\n    });\n    this.connection.on('stream', stream => {\n      if (this.debug) console.log('Client: connected to stream', stream);\n      this.fire('stream', { peer: this.connection, stream: stream });\n    });\n    this.connection._pc.addEventListener('signalingstatechange', () => {\n      console.log('signalState', this.connection._pc.signalingState);\n    });\n  }\n}\n","import * as Peer2 from 'simple-peer/simplepeer.min.js';\nimport { generateWebRTCpayload, recursivelyDecodeBlobs } from './dataUtils.js';\n// import adapter from \"webrtc-adapter/src/js/adapter_core.js\";\nimport * as msgpacklite from 'msgpack-lite/dist/msgpack.min.js';\n\nvar msgPack = msgpacklite.default;\nvar Peer = Peer2.default;\nwindow.simpPeer = Peer;\nconsole.log('msg pack', msgpacklite);\n\nexport class PeerBinary extends Peer {\n  constructor(options) {\n    //console.log('PeerBinary contructor called')\n    super(options);\n    this._registerDataMessage();\n    this.unchunker = new UnChunker(); //\n    this.unchunker.onData = val => {\n      this.emit('dataBig', val);\n    };\n    this.peerID = options.peerID;\n  }\n\n  //want to overide these 2 functions I think.\n  _registerDataMessage(event) {\n    this.on('data', data => {\n      //when its done with a complete chunk, call this.emit('dataBig', completed)\n      this.unchunker.registerChunk(data);\n    });\n  }\n\n  async sendBig(chunk) {\n    let stuff = await generateWebRTCpayload(chunk);\n    this.send(stuff.header);\n    for (var i in stuff.chunks) {\n      var ch = stuff.chunks[i];\n      this.send(ch);\n    }\n  }\n}\n\n//\n// Takes a bunch of possibly out of order shunks and assembles them into one\n//\nexport class UnChunker {\n  constructor() {\n    this.payloads = {};\n    this.payloadCount = 0;\n    this.onData = function(val) {\n      console.log('default, data is ready:', val);\n    };\n  }\n\n  registerChunk(msg) {\n    var header = this.parseHeader(msg);\n    if (header) {\n      this._newPayload(header.payloadID, header);\n    } else if (this._isChunk(msg)) {\n      //the is a chunk hopefully\n      try {\n        let val = msgPack.decode(msg);\n        this._appendToPayload(val);\n        //this.emit('dataBig', val)\n        if (this._isPayloadReady(val.payloadID)) {\n          this._assembleChunks(val.payloadID, result => {\n            this.onData(result);\n            return result;\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        console.error('val:', msg);\n      }\n    } else {\n      console.warn('not my type', msg);\n      //console.warn(this._ab2str(msg))\n    }\n    return null;\n  }\n\n  _newPayload(id, header) {\n    this.payloads[id] = Object.assign(header, {\n      count: header.chunkCount,\n      chunks: [],\n      lastUpdate: new Date(),\n    });\n    this.payloadCount++;\n  }\n\n  _appendToPayload(chunk) {\n    var pl = this.payloads[chunk.payloadID];\n    pl.lastUpdate = new Date();\n    pl.chunks.push(chunk);\n  }\n\n  async _assembleChunks(payloadID, cb) {\n    var pl = this.payloads[payloadID];\n    pl.chunks.sort(function(a, b) {\n      return Number(a.id) - Number(b.id);\n    });\n    var totalSize = 0;\n    for (var i = 0; i < pl.chunks.length; i++) {\n      totalSize += pl.chunks[i].chunk.length;\n    }\n    var result = new Uint8Array(totalSize);\n    var position = 0;\n    for (var i = 0; i < pl.chunks.length; i++) {\n      var ch = pl.chunks[i];\n      result.set(ch.chunk, position);\n      position += ch.chunk.length;\n    }\n    try {\n      let val1 = msgPack.decode(result);\n      let val2 = await recursivelyDecodeBlobs(val1);\n      cb(val2);\n      this._removePayload(payloadID);\n    } catch (err) {\n      console.error(err);\n      console.error('buffer', result);\n    }\n  }\n\n  _removePayload(id) {\n    delete this.payloads[id];\n    this.payloadCount--;\n  }\n\n  parseHeader(data) {\n    if (typeof data == 'object' && !(data instanceof Uint8Array)) {\n      if (data.chunkCount && data.chunkCount > 0) {\n        return data;\n      }\n    } else if (data.length && data.length < 4000) {\n      // might have been packed or something.\n      var json = msgPack.decode(data);\n      if (json) {\n        try {\n          if (json && json.iAmAHeader) {\n            return json;\n          }\n        } catch (er) {\n          // probably not a header. Not a big deal\n        }\n      }\n    }\n    return undefined;\n  }\n\n  _isChunk(msg) {\n    if (this.payloadCount <= 0) {\n      return false;\n    }\n    return msg instanceof Uint8Array || msg instanceof DataView;\n  }\n\n  _isPayloadReady(id) {\n    var pl = this.payloads[id];\n    if (pl.chunks.length == pl.count) {\n      return true;\n    }\n    return false;\n  }\n}\n"],"names":["msgpacklite.default","msgPack","Peer2.default","firebase2.default","firebase","Peer","PeerBinary","UnChunker"],"mappings":";;;;;AACO,MAAM,OAAO,CAAC;EACnB,WAAW,GAAG;IACZ,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;GAClB;;EAED,EAAE,CAAC,SAAS,EAAE,QAAQ,EAAE;IACtB,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE,OAAO;IAC3C,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;MAC3C,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;KAC7B;IACD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;GACvC;;EAED,GAAG,CAAC,SAAS,EAAE,QAAQ,EAAE;IACvB,IAAI,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;MACzC,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;;QAElC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;YACzC,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,OAAO,CAAC,EAAE;SACjD,EAAC;OACH,MAAM;QACL,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;OAC/B;KACF;GACF;;EAED,IAAI,CAAC,SAAS,EAAE,QAAQ,EAAE;;IAExB,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;MAC1B,KAAK,IAAI,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;QACrC,UAAU,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAC;OAC/B;KACF;GACF;;EAED,OAAO,CAAC,QAAQ,EAAE;IAChB,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,EAAE;MACzB,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;KACxB;GACF;CACF;;ACzCM,IAAI,QAAQ,GAAG;;;;EAIpB,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC;EAC3B,WAAW,EAAE;IACX;MACE,GAAG,EAAE,oBAAoB;MACzB,IAAI,EAAE,oBAAoB;KAC3B;IACD;MACE,GAAG,EAAE,gDAAgD;MACrD,QAAQ;QACN,kEAAkE;MACpE,UAAU,EAAE,8CAA8C;MAC1D,IAAI,EAAE,gDAAgD;KACvD;GACF;EACD,iBAAiB,EAAE,KAAK;EACxB,KAAK,EAAE,KAAK;CACb,CAAC;;AChBF,IAAI,OAAO,GAAGA,oBAAmB,CAAC;;AAElC,IAAI,aAAa,CAAC;;AAElB,MAAM,mBAAmB,GAAG,EAAE,CAAC;;;;AAI/B,AAAO,eAAe,qBAAqB,CAAC,GAAG,EAAE;EAC/C,IAAI,SAAS,GAAG,MAAM,sBAAsB,CAAC,GAAG,CAAC,CAAC;EAClD,IAAI,MAAM,GAAG,sBAAsB,CAAC,SAAS,CAAC,CAAC;EAC/C,OAAO,MAAM,CAAC;CACf;AACD,AAAO,SAAS,MAAM,CAAC,GAAG,EAAE;EAC1B,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IACtC,IAAI,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;IAC9B,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,WAAW;MAC5C,MAAM,IAAI,GAAG,IAAI,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;MAC1C,IAAI,QAAQ,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC;MAChD,IAAI,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC;MAC/D,IAAI,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;MACvC,IAAI,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;MACvC,IAAI,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;MACvC,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;MACrB,OAAO,CAAC,QAAQ,CAAC,CAAC;KACnB,CAAC,CAAC;IACH,MAAM,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;GAC/B,CAAC,CAAC;CACJ;;AAED,AAAO,eAAe,sBAAsB,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,EAAE;EAC3D,IAAI,KAAK,GAAG,mBAAmB,EAAE;IAC/B,OAAO,AAAqB,KAAK,EAAE;GACpC;EACD,IAAI,GAAG,CAAC,WAAW,IAAI,IAAI,IAAI,GAAG,CAAC,WAAW,IAAI,IAAI,EAAE;IACtD,OAAO,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC;GAC1B,MAAM,IAAI,GAAG,CAAC,WAAW,IAAI,MAAM,EAAE;IACpC,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,KAAK,IAAI,CAAC,IAAI,GAAG,EAAE;MACjB,GAAG,CAAC,CAAC,CAAC,GAAG,MAAM,sBAAsB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;KAC1D;IACD,OAAO,GAAG,CAAC;GACZ;EACD,OAAO,GAAG,CAAC;CACZ;;AAED,AAAO,eAAe,sBAAsB,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,EAAE;EAC3D,IAAI,KAAK,GAAG,mBAAmB,EAAE;IAC/B,OAAO,AAAqB,KAAK,EAAE;GACpC;EACD,IAAI,GAAG,CAAC,WAAW,IAAI,MAAM,IAAI,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,MAAM,EAAE;IACvD,IAAI,QAAQ,GAAG,EAAE,CAAC;IAClB,KAAK,IAAI,CAAC,IAAI,GAAG,EAAE;MACjB,IAAI,CAAC,KAAK,MAAM,IAAI,CAAC,IAAI,QAAQ,EAAE;QACjC,QAAQ,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;OACtB;KACF;IACD,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,CAAC;IAC1C,OAAO,IAAI,CAAC;GACb,MAAM,IAAI,GAAG,CAAC,WAAW,IAAI,MAAM,EAAE;IACpC,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,KAAK,IAAI,CAAC,IAAI,GAAG,EAAE;MACjB,GAAG,CAAC,CAAC,CAAC,GAAG,MAAM,sBAAsB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;KAC1D;IACD,OAAO,GAAG,CAAC;GACZ;EACD,OAAO,GAAG,CAAC;CACZ;;AAED,AAAO,eAAe,sBAAsB,CAAC,GAAG,EAAE,SAAS,GAAG,EAAE,EAAE;;EAEhE,IAAI,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;EAC9B,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM;IACxB;MACE,UAAU,EAAE,IAAI;MAChB,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,SAAS,CAAC;KACjD;IACD,SAAS;GACV,CAAC;EACF,IAAI,MAAM,GAAG,mBAAmB,CAAC,GAAG,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;EACxD,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;;EAElC,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;CAC3D;;AAED,AAAO,SAAS,mBAAmB,CAAC,IAAI,EAAE,SAAS,EAAE;;EAEnD,IAAI,MAAM,GAAG,EAAE,CAAC;EAChB,IAAI,YAAY,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;EACxC,IAAI,KAAK,GAAG,CAAC,CAAC;EACd,SAAS,GAAG,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,SAAS,CAAC,CAAC;EAC/D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,QAAQ,CAAC,UAAU,EAAE;IAC7D,IAAI,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC;IACnE,IAAI,KAAK,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,CAAC;IACjD,IAAI,EAAE,GAAG,KAAK,CAAC;IACf,IAAI,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;IAC3E,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACnB,KAAK,EAAE,CAAC;GACT;;;EAGD,OAAO,MAAM,CAAC;CACf;;AAED,AAAO,SAAS,WAAW,CAAC,GAAG,EAAE,EAAE,EAAE;EACnC,IAAI,CAAC,aAAa,EAAE;IAClB,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;GAClD;EACD,aAAa,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;EAChC,aAAa,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;EAClC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;EAC3E,aAAa,CAAC,MAAM,CAAC,SAAS,IAAI,EAAE;IAClC,EAAE,CAAC,IAAI,CAAC,CAAC;GACV,CAAC,CAAC;CACJ;;ACjHD,IAAIC,SAAO,GAAGD,oBAAmB,CAAC;AAClC,IAAI,IAAI,GAAGE,cAAa,CAAC;AACzB,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC;AACvB,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;;AAErC,AAAO,MAAM,UAAU,SAAS,IAAI,CAAC;EACnC,WAAW,CAAC,OAAO,EAAE;;IAEnB,KAAK,CAAC,OAAO,CAAC,CAAC;IACf,IAAI,CAAC,oBAAoB,EAAE,CAAC;IAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,SAAS,EAAE,CAAC;IACjC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,GAAG,IAAI;MAC7B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;KAC3B,CAAC;IACF,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;GAC9B;;;EAGD,oBAAoB,CAAC,KAAK,EAAE;IAC1B,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,IAAI;;MAEtB,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;KACpC,CAAC,CAAC;GACJ;;EAED,MAAM,OAAO,CAAC,KAAK,EAAE;IACnB,IAAI,KAAK,GAAG,MAAM,qBAAqB,CAAC,KAAK,CAAC,CAAC;IAC/C,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;IACxB,KAAK,IAAI,CAAC,IAAI,KAAK,CAAC,MAAM,EAAE;MAC1B,IAAI,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MACzB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KACf;GACF;CACF;;;;;AAKD,AAAO,MAAM,SAAS,CAAC;EACrB,WAAW,GAAG;IACZ,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACnB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;IACtB,IAAI,CAAC,MAAM,GAAG,SAAS,GAAG,EAAE;MAC1B,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,GAAG,CAAC,CAAC;KAC7C,CAAC;GACH;;EAED,aAAa,CAAC,GAAG,EAAE;IACjB,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IACnC,IAAI,MAAM,EAAE;MACV,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;KAC5C,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;;MAE7B,IAAI;QACF,IAAI,GAAG,GAAGD,SAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;;QAE3B,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;UACvC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,IAAI;YAC5C,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACpB,OAAO,MAAM,CAAC;WACf,CAAC,CAAC;SACJ;OACF,CAAC,OAAO,GAAG,EAAE;QACZ,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnB,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;OAC5B;KACF,MAAM;MACL,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;;KAElC;IACD,OAAO,IAAI,CAAC;GACb;;EAED,WAAW,CAAC,EAAE,EAAE,MAAM,EAAE;IACtB,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE;MACxC,KAAK,EAAE,MAAM,CAAC,UAAU;MACxB,MAAM,EAAE,EAAE;MACV,UAAU,EAAE,IAAI,IAAI,EAAE;KACvB,CAAC,CAAC;IACH,IAAI,CAAC,YAAY,EAAE,CAAC;GACrB;;EAED,gBAAgB,CAAC,KAAK,EAAE;IACtB,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACxC,EAAE,CAAC,UAAU,GAAG,IAAI,IAAI,EAAE,CAAC;IAC3B,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACvB;;EAED,MAAM,eAAe,CAAC,SAAS,EAAE,EAAE,EAAE;IACnC,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAClC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE;MAC5B,OAAO,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;KACpC,CAAC,CAAC;IACH,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACzC,SAAS,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC;KACxC;IACD,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC;IACvC,IAAI,QAAQ,GAAG,CAAC,CAAC;IACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACzC,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MACtB,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;MAC/B,QAAQ,IAAI,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC;KAC7B;IACD,IAAI;MACF,IAAI,IAAI,GAAGA,SAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;MAClC,IAAI,IAAI,GAAG,MAAM,sBAAsB,CAAC,IAAI,CAAC,CAAC;MAC9C,EAAE,CAAC,IAAI,CAAC,CAAC;MACT,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;KAChC,CAAC,OAAO,GAAG,EAAE;MACZ,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;MACnB,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;KACjC;GACF;;EAED,cAAc,CAAC,EAAE,EAAE;IACjB,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACzB,IAAI,CAAC,YAAY,EAAE,CAAC;GACrB;;EAED,WAAW,CAAC,IAAI,EAAE;IAChB,IAAI,OAAO,IAAI,IAAI,QAAQ,IAAI,EAAE,IAAI,YAAY,UAAU,CAAC,EAAE;MAC5D,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE;QAC1C,OAAO,IAAI,CAAC;OACb;KACF,MAAM,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,EAAE;;MAE5C,IAAI,IAAI,GAAGA,SAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;MAChC,IAAI,IAAI,EAAE;QACR,IAAI;UACF,IAAI,IAAI,IAAI,IAAI,CAAC,UAAU,EAAE;YAC3B,OAAO,IAAI,CAAC;WACb;SACF,CAAC,OAAO,EAAE,EAAE;;SAEZ;OACF;KACF;IACD,OAAO,SAAS,CAAC;GAClB;;EAED,QAAQ,CAAC,GAAG,EAAE;IACZ,IAAI,IAAI,CAAC,YAAY,IAAI,CAAC,EAAE;MAC1B,OAAO,KAAK,CAAC;KACd;IACD,OAAO,GAAG,YAAY,UAAU,IAAI,GAAG,YAAY,QAAQ,CAAC;GAC7D;;EAED,eAAe,CAAC,EAAE,EAAE;IAClB,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAC3B,IAAI,EAAE,CAAC,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC,KAAK,EAAE;MAChC,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;GACd;CACF;;AChKS,IAAC,QAAQ,GAAGE,mBAAkB;;AAExC,IAAI,eAAe,GAAG;EACpB,MAAM,EAAE,yCAAyC;EACjD,UAAU,EAAE,0CAA0C;EACtD,WAAW,EAAE,0CAA0C;EACvD,SAAS,EAAE,kBAAkB;CAC9B,CAAC;;AAEF,IAAI,QAAQ,CAAC;;AAEb,AAAO,SAAS,WAAW,GAAG;EAC5B,IAAI,QAAQ,EAAE,OAAO,QAAQ,CAAC;EAC9B,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;EACxC,QAAQ,GAAG,QAAQ;KAChB,QAAQ,EAAE;KACV,GAAG,CAAC,GAAG,CAAC;KACR,KAAK,CAAC,OAAO,CAAC,CAAC;EAClB,OAAO,QAAQ,CAAC;CACjB;;ACfD,IAAIC,UAAQ,GAAGD,kBAAiB,CAAC;;AAEjC,AAAO,MAAM,OAAO,CAAC;EACnB,WAAW,CAAC,KAAK,EAAE,IAAI,EAAE;IACvB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IACxC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IACvC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;EAED,OAAO,GAAG;IACR,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;IAClB,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;IACjB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;GACrB;CACF;;AAED,AAAO,MAAM,SAAS,SAAS,OAAO,CAAC;EACrC,WAAW,CAAC,OAAO,GAAG,EAAE,EAAE;IACxB,KAAK,EAAE,CAAC;IACR,OAAO,CAAC,MAAM;MACZ,OAAO,CAAC,UAAU;MAClB,4CAA4C;KAC7C,CAAC;IACF,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IACzB,IAAI,CAAC,EAAE,GAAG,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC;IACxD,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;IACxB,IAAI,CAAC,UAAU;MACb,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,WAAW,IAAI,QAAQ,CAAC,WAAW,CAAC;IACpE,IAAI,CAAC,QAAQ,CAAC;IACd,IAAI,CAAC,iBAAiB;MACpB,OAAO,CAAC,iBAAiB,IAAI,QAAQ,CAAC,iBAAiB,CAAC;IAC1D,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IAC7B,IAAI,OAAO,CAAC,QAAQ,EAAE;MACpB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;KAClC,MAAM;MACL,IAAI,CAAC,QAAQ,GAAG,WAAW,EAAE,CAAC;KAC/B;IACD,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACrC,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE;MAC5B,IAAI,CAAC,IAAI,EAAE,CAAC;KACb;GACF;;EAED,IAAI,GAAG;IACL,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC1B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACpC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IAClD,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,MAAM,EAAE,CAAC;IACrC,IAAI,CAAC,SAAS,CAAC,GAAG,CAACC,UAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;IAC5D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;IACjD,IAAI,IAAI,CAAC,MAAM,EAAE;MACf,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;KAC1C;IACD,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IACxB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IACtB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC,MAAM;MACnC,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;MACxC,IAAI,CAAC,iBAAiB,EAAE,CAAC;KAC1B,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAC3B,IAAI,CAAC,gBAAgB,EAAE,CAAC;IACxB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IACxB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;GAC9B;;EAED,iBAAiB,GAAG;;IAElB,IAAI,CAAC,SAAS,CAAC,GAAG,CAACA,UAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;GAC7D;;EAED,SAAS,CAAC,IAAI,EAAE;IACd,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE;MACjC,IAAI,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE;QACrB,IAAI;UACF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC;SACtC,CAAC,OAAO,GAAG,EAAE;UACZ,OAAO,CAAC,KAAK,CAAC,GAAG,EAAE,wCAAwC,CAAC,CAAC;SAC9D;OACF;KACF;GACF;;EAED,YAAY,CAAC,IAAI,EAAE;IACjB,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE;MACjC,IAAI,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE;QACrB,IAAI;UACF,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC;SACzC,CAAC,OAAO,GAAG,EAAE;UACZ,OAAO,CAAC,KAAK,CAAC,GAAG,EAAE,wCAAwC,CAAC,CAAC;SAC9D;OACF;KACF;GACF;;EAED,gBAAgB,GAAG;;;;IAIjB,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,aAAa,EAAE,EAAE,IAAI;MACtC,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,eAAe,EAAE;QAClD,OAAO,CAAC,KAAK;UACX,+DAA+D;SAChE,CAAC;QACF,OAAO;OACR;MACD,IAAI,GAAG,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;MACnB,IAAI,IAAI,CAAC,KAAK,EAAE;QACd,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;OAC/B;MACD,KAAK,IAAI,CAAC,IAAI,GAAG,CAAC,UAAU,EAAE;QAC5B,IAAI,GAAG,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC5B,IAAI,GAAG,CAAC,IAAI,KAAK,OAAO,EAAE;UACxB,IAAI,KAAK,GAAG,EAAE,CAAC,GAAG,CAAC;UACnB,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC;UAC3B,IAAI,OAAO,GAAG,IAAI,OAAO;YACvB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC;YAC5B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;WACrB,CAAC;UACF,IAAI,CAAC,WAAW,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;UAClD,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;;;;UAIpC,IAAI,aAAa,GAAG,KAAK,CAAC;UAC1B,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,IAAI;YAChC,IAAI,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE;cAC1B,IAAI,aAAa,EAAE;gBACjB,OAAO,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;eAC1D;cACD,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;cAC1B,aAAa,GAAG,IAAI,CAAC;aACtB,MAAM,IAAI,IAAI,CAAC,SAAS,EAAE;cACzB,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC3B,MAAM;cACL,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,gCAAgC,CAAC,CAAC;aACtD;WACF,CAAC,CAAC;;;;UAIH,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,EAAE,GAAG,IAAI;YACrC,IAAI,IAAI,GAAG,GAAG,CAAC,GAAG,EAAE,CAAC;YACrB,IAAI,IAAI,CAAC,KAAK,EAAE;cACd,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;aAC9C;YACD,IAAI,IAAI,CAAC,SAAS,EAAE;cAClB,IAAI,IAAI,CAAC,KAAK,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,oCAAoC,CAAC,CAAC;eACzD;cACD,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;aAC3B,MAAM,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;cAChC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;aAC3B,MAAM,IAAI,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE,CAElC,MAAM;cACL,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;aACxD;WACF,CAAC,CAAC;SACJ;OACF;KACF,CAAC,CAAC;GACJ;;EAED,SAAS,CAAC,MAAM,EAAE;IAChB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,gCAAgC,EAAE,MAAM,CAAC,CAAC;IACtE,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;IACjC,IAAI,SAAS,GAAG;MACd,SAAS,EAAE,KAAK;MAChB,OAAO,EAAE,IAAI;MACb,MAAM,EAAE;QACN,UAAU,EAAE,IAAI,CAAC,UAAU;OAC5B;MACD,MAAM;KACP,CAAC;IACF,IAAI,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;IAChD,IAAI,CAAC,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC;;IAElC,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI;MACnB,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC;MACpC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;KAC3C,CAAC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC,SAAS,EAAE,MAAM;MACpB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;MACxD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;KACnC,CAAC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,IAAI;MACnB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,qCAAqC,EAAE,IAAI,CAAC,CAAC;MACzE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;KAC5C,CAAC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM;MAClB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,CAAC,CAAC,CAAC;MAC5D,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;MAC1B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;KACjC,CAAC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,IAAI;MACtB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;KAC/C,CAAC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAM,IAAI;MACvB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,MAAM,CAAC,CAAC;MACnE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;KAClD,CAAC,CAAC;;IAEH,OAAO,CAAC,CAAC;GACV;;EAED,OAAO,GAAG;IACR,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;IACzB,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;IACxB,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;IACtB,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;IACrB,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;IACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IACzB,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW,EAAE;MAC9B,CAAC,CAAC,OAAO,EAAE,CAAC;KACb;IACD,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;IAC3B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IACtB,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;GACjC;;EAED,iBAAiB,CAAC,IAAI,EAAE;IACtB,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;IACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MAChD,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;MAC/B,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,EAAE;QACrB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5D,KAAK,GAAG,CAAC,CAAC;OACX;KACF;IACD,IAAI,KAAK,IAAI,CAAC,EAAE;MACd,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;MACnC,IAAI,CAAC,OAAO,EAAE,CAAC;MACf,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;MAClC,IAAI,CAAC,WAAW,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;MACzC,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC;MACpC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KAC/C;GACF;CACF;;AC/OM,MAAM,SAAS,SAAS,OAAO,CAAC;EACrC,WAAW,CAAC,OAAO,GAAG,EAAE,EAAE;IACxB,KAAK,EAAE,CAAC;IACR,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC9B,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;;IAE7B,IAAI,CAAC,UAAU;MACb,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,WAAW,IAAI,QAAQ,CAAC,WAAW,CAAC;;IAEpE,IAAI,OAAO,CAAC,QAAQ,EAAE;MACpB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;KAClC,MAAM;MACL,IAAI,CAAC,QAAQ,GAAG,WAAW,EAAE,CAAC;KAC/B;;IAED,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC3B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IACvB,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;IACxB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACrB,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;IAC9B,IAAI,CAAC,oBAAoB,GAAG,SAAS,CAAC;GACvC;;EAED,WAAW,CAAC,QAAQ,EAAE;IACpB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI;MAC7B,IAAI,GAAG,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;MACnB,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;MACpB,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KACrB,CAAC,CAAC;GACJ;;EAED,eAAe,CAAC,EAAE,EAAE,QAAQ,GAAG,MAAM,EAAE,EAAE;IACvC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACxC,IAAI,CAAC,WAAW,CAAC,MAAM;MACrB,IAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;MAC7B,IAAI,CAAC,IAAI,EAAE;QACT,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAAC;QAC3C,QAAQ,CAAC,kBAAkB,CAAC,CAAC;OAC9B,MAAM;QACL,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI;UAClC,IAAI,IAAI,GAAG,GAAG,CAAC,GAAG,EAAE,CAAC;UACrB,IAAI,KAAK,GAAG;YACV,SAAS,EAAE,IAAI;YACf,OAAO,EAAE,IAAI;YACb,MAAM,EAAE;cACN,UAAU,EAAE,IAAI,CAAC,UAAU;aAC5B;WACF,CAAC;;UAEF,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE;YAClC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;WACnC;UACD,IAAI,CAAC,GAAG,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC;UAC9B,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;UACpB,IAAI,CAAC,eAAe,EAAE,CAAC;UACvB,CAAC,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,IAAI;YACrB,IAAI,IAAI,CAAC,IAAI,IAAI,OAAO,EAAE;cACxB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;aAC3B,MAAM,IAAI,IAAI,CAAC,SAAS,EAAE;cACzB,IAAI,IAAI,CAAC,KAAK,EAAE;gBACd,OAAO,CAAC,GAAG,CAAC,uCAAuC,EAAE,IAAI,CAAC,CAAC;eAC5D;cACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACxB,MAAM;cACL,OAAO,CAAC,IAAI;gBACV,mDAAmD;gBACnD,IAAI;eACL,CAAC;aACH;WACF,CAAC,CAAC;UACH,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;SACjC,CAAC,CAAC;OACJ;KACF,CAAC,CAAC;GACJ;;EAED,WAAW,GAAG;IACZ,IAAI,IAAI,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC;;;;IAIpC,IAAI,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAClD,UAAU,CAAC,KAAK,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;IACzC,IAAI,UAAU,GAAG,UAAU,CAAC,aAAa,EAAE,CAAC;IAC5C,OAAO,UAAU,CAAC;GACnB;;EAED,UAAU,CAAC,QAAQ,EAAE;IACnB,QAAQ;MACN,QAAQ;MACR,WAAW;QACT,OAAO,CAAC,GAAG,CAAC,iCAAiC,EAAE,SAAS,CAAC,CAAC;OAC3D,CAAC;;IAEJ,IAAI,IAAI,CAAC,SAAS,EAAE;MAClB,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;KACtB;IACD,IAAI,IAAI,CAAC,MAAM,EAAE;MACf,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;KACnB;IACD,IAAI,IAAI,CAAC,KAAK,EAAE;MACd,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;KAClB;IACD,IAAI,IAAI,CAAC,UAAU,EAAE;MACnB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;KACnC,MAAM;MACL,QAAQ,EAAE,CAAC;KACZ;;;GAGF;;EAED,cAAc,CAAC,KAAK,EAAE;;IAEpB,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;IAC3B,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;IACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC;MACtD,UAAU,EAAE,CAAC,KAAK,CAAC;KACpB,CAAC,CAAC;IACH,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IAClD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IACjD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,EAAE,EAAE,IAAI;MACjC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,yBAAyB,CAAC,CAAC;MACjE,IAAI,GAAG,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;MACnB,IAAI,GAAG,CAAC,IAAI,KAAK,QAAQ,EAAE;QACzB,UAAU,CAAC,MAAM;UACf,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,cAAc,CAAC;UAC/C,IAAI,KAAK,IAAI,IAAI,CAAC,oBAAoB,EAAE;YACtC,IAAI,IAAI,CAAC,KAAK;cACZ,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAC;YACvD,OAAO;WACR;UACD,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;UACxD,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;UAClC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;UAC5C,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC7D,EAAE,EAAE,CAAC,CAAC;OACR,MAAM,IAAI,GAAG,CAAC,SAAS,EAAE;QACxB,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,yCAAyC,CAAC,CAAC;QACvE,UAAU,CAAC,MAAM;UACf,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC7D,EAAE,EAAE,CAAC,CAAC;OACR,MAAM;QACL,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,oDAAoD,CAAC,CAAC;OACzE;KACF,CAAC,CAAC;GACJ;;EAED,eAAe,GAAG;;IAEhB,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI;MACjC,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC;MACpC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;KACzD,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,SAAS,EAAE,MAAM;MAClC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;MACxD,IAAI;QACF,KAAK,IAAI,QAAQ,IAAI,IAAI,CAAC,mBAAmB,EAAE;UAC7C,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;SACjC;QACD,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;OAC/B,CAAC,OAAO,GAAG,EAAE;QACZ,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;OACnB;MACD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;KACjD,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,IAAI;MACjC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,qCAAqC,EAAE,IAAI,CAAC,CAAC;MACzE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;KAC1D,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,IAAI;MAClC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;MAClE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;KAC/C,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,IAAI;MACpC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;KAC7D,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAM,IAAI;MACrC,IAAI,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,MAAM,CAAC,CAAC;MACnE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;KAChE,CAAC,CAAC;IACH,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,MAAM;MACjE,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;KAChE,CAAC,CAAC;GACJ;CACF;;AC5LD,IAAIH,SAAO,GAAGD,oBAAmB,CAAC;AAClC,IAAIK,MAAI,GAAGH,cAAa,CAAC;AACzB,MAAM,CAAC,QAAQ,GAAGG,MAAI,CAAC;AACvB,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;;AAErC,AAAO,MAAMC,YAAU,SAASD,MAAI,CAAC;EACnC,WAAW,CAAC,OAAO,EAAE;;IAEnB,KAAK,CAAC,OAAO,CAAC,CAAC;IACf,IAAI,CAAC,oBAAoB,EAAE,CAAC;IAC5B,IAAI,CAAC,SAAS,GAAG,IAAIE,WAAS,EAAE,CAAC;IACjC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,GAAG,IAAI;MAC7B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;KAC3B,CAAC;IACF,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;GAC9B;;;EAGD,oBAAoB,CAAC,KAAK,EAAE;IAC1B,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,IAAI;;MAEtB,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;KACpC,CAAC,CAAC;GACJ;;EAED,MAAM,OAAO,CAAC,KAAK,EAAE;IACnB,IAAI,KAAK,GAAG,MAAM,qBAAqB,CAAC,KAAK,CAAC,CAAC;IAC/C,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;IACxB,KAAK,IAAI,CAAC,IAAI,KAAK,CAAC,MAAM,EAAE;MAC1B,IAAI,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MACzB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KACf;GACF;CACF;;;;;AAKD,AAAO,MAAMA,WAAS,CAAC;EACrB,WAAW,GAAG;IACZ,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACnB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;IACtB,IAAI,CAAC,MAAM,GAAG,SAAS,GAAG,EAAE;MAC1B,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,GAAG,CAAC,CAAC;KAC7C,CAAC;GACH;;EAED,aAAa,CAAC,GAAG,EAAE;IACjB,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IACnC,IAAI,MAAM,EAAE;MACV,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;KAC5C,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;;MAE7B,IAAI;QACF,IAAI,GAAG,GAAGN,SAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;;QAE3B,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;UACvC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,IAAI;YAC5C,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACpB,OAAO,MAAM,CAAC;WACf,CAAC,CAAC;SACJ;OACF,CAAC,OAAO,GAAG,EAAE;QACZ,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnB,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;OAC5B;KACF,MAAM;MACL,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;;KAElC;IACD,OAAO,IAAI,CAAC;GACb;;EAED,WAAW,CAAC,EAAE,EAAE,MAAM,EAAE;IACtB,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE;MACxC,KAAK,EAAE,MAAM,CAAC,UAAU;MACxB,MAAM,EAAE,EAAE;MACV,UAAU,EAAE,IAAI,IAAI,EAAE;KACvB,CAAC,CAAC;IACH,IAAI,CAAC,YAAY,EAAE,CAAC;GACrB;;EAED,gBAAgB,CAAC,KAAK,EAAE;IACtB,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACxC,EAAE,CAAC,UAAU,GAAG,IAAI,IAAI,EAAE,CAAC;IAC3B,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACvB;;EAED,MAAM,eAAe,CAAC,SAAS,EAAE,EAAE,EAAE;IACnC,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAClC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE;MAC5B,OAAO,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;KACpC,CAAC,CAAC;IACH,IAAI,SAAS,GAAG,CAAC,CAAC;IAClB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACzC,SAAS,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC;KACxC;IACD,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC;IACvC,IAAI,QAAQ,GAAG,CAAC,CAAC;IACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACzC,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MACtB,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;MAC/B,QAAQ,IAAI,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC;KAC7B;IACD,IAAI;MACF,IAAI,IAAI,GAAGA,SAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;MAClC,IAAI,IAAI,GAAG,MAAM,sBAAsB,CAAC,IAAI,CAAC,CAAC;MAC9C,EAAE,CAAC,IAAI,CAAC,CAAC;MACT,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;KAChC,CAAC,OAAO,GAAG,EAAE;MACZ,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;MACnB,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;KACjC;GACF;;EAED,cAAc,CAAC,EAAE,EAAE;IACjB,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACzB,IAAI,CAAC,YAAY,EAAE,CAAC;GACrB;;EAED,WAAW,CAAC,IAAI,EAAE;IAChB,IAAI,OAAO,IAAI,IAAI,QAAQ,IAAI,EAAE,IAAI,YAAY,UAAU,CAAC,EAAE;MAC5D,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE;QAC1C,OAAO,IAAI,CAAC;OACb;KACF,MAAM,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,EAAE;;MAE5C,IAAI,IAAI,GAAGA,SAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;MAChC,IAAI,IAAI,EAAE;QACR,IAAI;UACF,IAAI,IAAI,IAAI,IAAI,CAAC,UAAU,EAAE;YAC3B,OAAO,IAAI,CAAC;WACb;SACF,CAAC,OAAO,EAAE,EAAE;;SAEZ;OACF;KACF;IACD,OAAO,SAAS,CAAC;GAClB;;EAED,QAAQ,CAAC,GAAG,EAAE;IACZ,IAAI,IAAI,CAAC,YAAY,IAAI,CAAC,EAAE;MAC1B,OAAO,KAAK,CAAC;KACd;IACD,OAAO,GAAG,YAAY,UAAU,IAAI,GAAG,YAAY,QAAQ,CAAC;GAC7D;;EAED,eAAe,CAAC,EAAE,EAAE;IAClB,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAC3B,IAAI,EAAE,CAAC,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC,KAAK,EAAE;MAChC,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;GACd;CACF;;;;"}