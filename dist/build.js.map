{"version":3,"file":"build.js","sources":["../src/Evented.js","../src/settings.js","../src/dataUtils.js","../src/PeerBinary.js","../src/defaultFirebase.js","../src/P2PServer.js","../src/P2PClient.js","../src/peerBinary.js"],"sourcesContent":["\nexport class Evented {\n  constructor() {\n    this.events = {};\n  }\n\n  on(eventName, callback) {\n    if (typeof callback !== \"function\") return;\n    if (! this.events.hasOwnProperty(eventName)) {\n      this.events[eventName] = [];\n    }\n    this.events[eventName].push(callback);\n  }\n\n  off(eventName, callback) {\n    if (this.events.hasOwnProperty(eventName)) {\n      if (typeof callback === \"function\") {\n        //_.without(this.events[eventName], callback);\n        this.events = this.events.filter( function(x){\n            if ( x != this.events[eventName]) { return x }\n        })\n      } else {\n        delete this.events[eventName];\n      }\n    }\n  }\n\n  fire(eventName, argument) {\n    //_.each(this.events[eventName], (cb) => setTimeout(() => cb(argument)));\n    if (this.events[eventName]) {\n      for (var cb of this.events[eventName]) {\n        setTimeout(() => cb(argument))\n      }\n    }\n  }\n\n  fireAll(argument) {\n    for (var k in this.events) {\n      this.fire(k, argument);\n    }\n  }\n}\n","export var settings = {\n  // Get a reference to the database service\n\n  // Was having a bug where the WIFI router would crash if the chunk size was bigger than 2^10\n  CHUNK_SIZE: Math.pow(2, 10), // size in bytes of the chunks. 2^16 is just under the limit in chrome.\n  ICE_SERVERS: [\n    {\n      url: 'stun:23.21.150.121',\n      urls: 'stun:23.21.150.121',\n    },\n    {\n      url: 'turn:global.turn.twilio.com:3478?transport=udp',\n      username:\n        '508d1e639868dc17f5da97a75b1d3b43bf2fc6d11e4e863678501db568b5665c',\n      credential: 'W5GTdhQQ6DqOD7k6bS8+xZVNQXm+fgLXSEQpN8bTe70=',\n      urls: 'turn:global.turn.twilio.com:3478?transport=udp',\n    },\n  ],\n  POLLING_FREQUENCY: 15000,\n  debug: false,\n};\n","import { Evented } from \"./Evented.js\";\nimport { settings } from \"./settings.js\";\nimport * as msgpacklite from \"msgpack-lite/dist/msgpack.min.js\";\n\nvar msgPack = msgpacklite.default;\n\nvar drawingCanvas; // this is a canvas used by imageToBlob\n\nconst MAX_RECURSIVE_DEPTH = 10;\n//\n// @param  {Function} callback []\n//\nexport async function generateWebRTCpayload(obj) {\n  let deBlobbed = await recursivelyEncodeBlobs(obj);\n  let result = _generateWebRTCpayload(deBlobbed);\n  return result;\n}\nexport function deBlob(obj) {\n  return new Promise((resolve, reject) => {\n    var reader = new FileReader();\n    reader.addEventListener(\"loadend\", function() {\n      const view = new Int8Array(reader.result);\n      let descript = { isBlob: true, type: obj.type };\n      if (obj.lastModified) descript.lastModified = obj.lastModified;\n      if (obj.name) descript.name = obj.name;\n      if (obj.size) descript.size = obj.size;\n      if (obj.exif) descript.exif = obj.exif;\n      descript.view = view; // _generateWebRTCpayload(view, descript);\n      resolve(descript);\n    });\n    reader.readAsArrayBuffer(obj);\n  });\n}\n\nexport async function recursivelyEncodeBlobs(obj, depth = 0) {\n  if (depth > MAX_RECURSIVE_DEPTH) {\n    throw (\"max depth reached\", depth);\n  }\n  if (obj.constructor == File || obj.constructor == Blob) {\n    return await deBlob(obj);\n  } else if (obj.constructor == Object) {\n    let res = {};\n    for (var i in obj) {\n      res[i] = await recursivelyEncodeBlobs(obj[i], depth + 1);\n    }\n    return res;\n  }\n  return obj;\n}\n\nexport async function recursivelyDecodeBlobs(obj, depth = 0) {\n  if (depth > MAX_RECURSIVE_DEPTH) {\n    throw (\"max depth reached\", depth);\n  }\n  if (obj.constructor == Object && obj.type && obj.isBlob) {\n    let descript = {};\n    for (var i in obj) {\n      if (i !== \"view\" && i != \"chunks\") {\n        descript[i] = obj[i];\n      }\n    }\n    let val1 = new Blob([obj.view], descript);\n    return val1;\n  } else if (obj.constructor == Object) {\n    let res = {};\n    for (var i in obj) {\n      res[i] = await recursivelyDecodeBlobs(obj[i], depth + 1);\n    }\n    return res;\n  }\n  return obj;\n}\n\nexport async function _generateWebRTCpayload(obj, headerOpt = {}) {\n  //console.time('generateWebRTCpayload')\n  let bin = msgPack.encode(obj);\n  var header = Object.assign(\n    {\n      iAmAHeader: true,\n      payloadID: Math.floor(Math.random() * 100000000)\n    },\n    headerOpt\n  );\n  var chunks = arrayBufferToChunks(bin, header.payloadID);\n  header.chunkCount = chunks.length;\n  //console.timeEnd('generateWebRTCpayload')\n  return { header: msgPack.encode(header), chunks: chunks };\n}\n\nexport function arrayBufferToChunks(buff, payloadID) {\n  //console.time('chunks')\n  var result = [];\n  var wholeshebang = new Uint8Array(buff);\n  var count = 0;\n  payloadID = payloadID || Math.floor(Math.random() * 100000000);\n  for (var i = 0; i < buff.byteLength; i += settings.CHUNK_SIZE) {\n    var chunksize = Math.min(buff.byteLength - i, settings.CHUNK_SIZE);\n    var chunk = wholeshebang.slice(i, i + chunksize);\n    var id = count; //new Uint8Array(idSize);\n    let chbin = msgPack.encode({ payloadID: payloadID, id: id, chunk: chunk });\n    result.push(chbin);\n    count++;\n  }\n  //console.timeEnd('chunks')\n  //console.log(`generated ${count} chunks`)\n  return result;\n}\n\nexport function imageToBlob(img, cb) {\n  if (!drawingCanvas) {\n    drawingCanvas = document.createElement(\"canvas\");\n  }\n  drawingCanvas.width = img.width;\n  drawingCanvas.height = img.height;\n  drawingCanvas.getContext(\"2d\").drawImage(img, 0, 0, img.width, img.height);\n  drawingCanvas.toBlob(function(blob) {\n    cb(blob);\n  });\n}\n","import * as Peer2 from 'simple-peer/simplepeer.min.js'\nimport { generateWebRTCpayload, recursivelyDecodeBlobs } from './dataUtils.js'\n// import adapter from \"webrtc-adapter/src/js/adapter_core.js\";\nimport * as msgpacklite from 'msgpack-lite/dist/msgpack.min.js'\n\nconst msgPack = msgpacklite.default\nconst Peer = Peer2.default\nwindow.simpPeer = Peer\n\nconst sleep = milliseconds => {\n    return new Promise(resolve => setTimeout(resolve, milliseconds))\n}\n\nexport class PeerBinary extends Peer {\n    constructor(options) {\n        //console.log('PeerBinary contructor called')\n        super(options)\n        this._registerDataMessage()\n        this.unchunker = new UnChunker() //\n        this.unchunker.onData = val => {\n            this.emit('dataBig', val)\n        }\n        this.peerID = options.peerID\n    }\n\n    //want to overide these 2 functions I think.\n    _registerDataMessage(event) {\n        this.on('data', data => {\n            //when its done with a complete chunk, call this.emit('dataBig', completed)\n            this.unchunker.registerChunk(data)\n        })\n    }\n\n    async sendBig(chunk) {\n        let stuff = await generateWebRTCpayload(chunk)\n        this.send(stuff.header)\n        for (var i in stuff.chunks) {\n            var ch = stuff.chunks[i]\n            this.send(ch)\n            await sleep(60) //give the other side time to handle message\n        }\n    }\n}\n\n//\n// Takes a bunch of possibly out of order shunks and assembles them into one\n//\nexport class UnChunker {\n    constructor() {\n        this.payloads = {}\n        this.payloadCount = 0\n        this.onData = function(val) {\n            console.log('default, data is ready:', val)\n        }\n    }\n\n    registerChunk(msg) {\n        var header = this.parseHeader(msg)\n        if (header) {\n            this._newPayload(header.payloadID, header)\n        } else if (this._isChunk(msg)) {\n            //the is a chunk hopefully\n            try {\n                let val = msgPack.decode(msg)\n                this._appendToPayload(val)\n                //this.emit('dataBig', val)\n                if (this._isPayloadReady(val.payloadID)) {\n                    this._assembleChunks(val.payloadID, result => {\n                        this.onData(result)\n                        return result\n                    })\n                }\n            } catch (err) {\n                console.error(err)\n                console.error('val:', msg)\n            }\n        } else {\n            console.warn('not my type', msg)\n            //console.warn(this._ab2str(msg))\n        }\n        return null\n    }\n\n    _newPayload(id, header) {\n        this.payloads[id] = Object.assign(header, {\n            count: header.chunkCount,\n            chunks: [],\n            lastUpdate: new Date(),\n        })\n        this.payloadCount++\n    }\n\n    _appendToPayload(chunk) {\n        var pl = this.payloads[chunk.payloadID]\n        pl.lastUpdate = new Date()\n        pl.chunks.push(chunk)\n    }\n\n    async _assembleChunks(payloadID, cb) {\n        var pl = this.payloads[payloadID]\n        pl.chunks.sort(function(a, b) {\n            return Number(a.id) - Number(b.id)\n        })\n        var totalSize = 0\n        for (var i = 0; i < pl.chunks.length; i++) {\n            totalSize += pl.chunks[i].chunk.length\n        }\n        var result = new Uint8Array(totalSize)\n        var position = 0\n        for (var i = 0; i < pl.chunks.length; i++) {\n            var ch = pl.chunks[i]\n            result.set(ch.chunk, position)\n            position += ch.chunk.length\n        }\n        try {\n            let val1 = msgPack.decode(result)\n            let val2 = await recursivelyDecodeBlobs(val1)\n            cb(val2)\n            this._removePayload(payloadID)\n        } catch (err) {\n            console.error(err)\n            console.error('buffer', result)\n        }\n    }\n\n    _removePayload(id) {\n        delete this.payloads[id]\n        this.payloadCount--\n    }\n\n    parseHeader(data) {\n        if (typeof data == 'object' && !(data instanceof Uint8Array)) {\n            if (data.chunkCount && data.chunkCount > 0) {\n                return data\n            }\n        } else if (data.length && data.length < 4000) {\n            // might have been packed or something.\n            var json = msgPack.decode(data)\n            if (json) {\n                try {\n                    if (json && json.iAmAHeader) {\n                        return json\n                    }\n                } catch (er) {\n                    // probably not a header. Not a big deal\n                }\n            }\n        }\n        return undefined\n    }\n\n    _isChunk(msg) {\n        if (this.payloadCount <= 0) {\n            return false\n        }\n        return msg instanceof Uint8Array || msg instanceof DataView\n    }\n\n    _isPayloadReady(id) {\n        var pl = this.payloads[id]\n        if (pl.chunks.length == pl.count) {\n            return true\n        }\n        return false\n    }\n}\n","import * as firebase2 from \"firebase/dist/index.esm\";\nexport var firebase = firebase2.default;\n\nvar defaultFBConfig = {\n  apiKey: \"AIzaSyBEbLlzJmmOC7CVfbeZs_HQBWia_xSb4sA\",\n  authDomain: \"https://torrid-torch-716.firebaseio.com/\",\n  databaseURL: \"https://torrid-torch-716.firebaseio.com/\",\n  projectId: \"torrid-torch-716\"\n};\n\nvar database;\n\nexport function getDatabase() {\n  if (database) return database;\n  firebase.initializeApp(defaultFBConfig);\n  database = firebase\n    .database()\n    .ref(\"/\")\n    .child(\"peers\");\n  return database;\n}\n","import { PeerBinary } from './PeerBinary.js'\nimport { settings } from './settings.js'\nimport { Evented } from './Evented.js'\nimport { getDatabase } from './defaultFirebase.js'\nimport * as firebase2 from 'firebase/dist/index.esm'\nvar firebase = firebase2.default\n\nexport class Channel {\n    constructor(fbref, peer) {\n        this.outRef = fbref.child('fromServer') //firebase\n        this.inRef = fbref.child('fromClient')\n        this.peer = peer // simple-peer\n    }\n\n    destroy() {\n        this.outRef.off()\n        this.inRef.off()\n        this.peer.destroy()\n    }\n}\n\nexport class P2PServer extends Evented {\n    constructor(options = {}) {\n        super() //no idea what this does\n        console.assert(\n            options.iceServers,\n            'Server: no ice servers yet. Using defaults'\n        )\n        this.MAX_CONNECTIONS = 50\n        this.debug = false\n        this.isListening = false\n        this.id = 'server_' + Math.floor(Math.random() * 100000)\n        this.stream = undefined\n        this.iceServers =\n            options.iceServers || options.ICE_SERVERS || settings.ICE_SERVERS\n        this.database\n        this.POLLING_FREQUENCY =\n            options.POLLING_FREQUENCY || settings.POLLING_FREQUENCY\n        Object.assign(this, options)\n        if (options.database) {\n            this.database = options.database\n        } else {\n            this.database = getDatabase()\n        }\n        if (this.debug) console.log(this.id)\n        if (!options.dontCallInitYet) {\n            this.init()\n        }\n    }\n\n    init() {\n        var fbref = this.database\n        this.userRef = fbref.child(this.id)\n        this.updateRef = this.userRef.child('lastUpdate')\n        this.userRef.onDisconnect().remove()\n        this.updateRef.set(firebase.database.ServerValue.TIMESTAMP)\n        this.channelRef = this.userRef.child('channels')\n        if (this.stream) {\n            this.userRef.child('isStream').set(true)\n        }\n        this.channelRef.set([])\n        this.connections = []\n        this._intervalID = setInterval(() => {\n            this.fire('updateTimeStamp', undefined)\n            this._updateOnFireBase()\n        }, this.POLLING_FREQUENCY)\n        this.listenToChannels()\n        this.isListening = true\n        this.fire('init', undefined)\n    }\n\n    _updateOnFireBase() {\n        // one may want to overwrite this\n        this.updateRef.set(firebase.database.ServerValue.TIMESTAMP)\n    }\n\n    sendToAll(data) {\n        for (var conx of this.connections) {\n            if (conx && conx.peer) {\n                try {\n                    conx.peer.send.bind(conx.peer)(data)\n                } catch (err) {\n                    console.error(err, 'Got an error, interrupted connection? ')\n                }\n            }\n        }\n    }\n\n    sendToAllBig(data) {\n        for (var conx of this.connections) {\n            if (conx && conx.peer) {\n                try {\n                    conx.peer.sendBig.bind(conx.peer)(data)\n                } catch (err) {\n                    console.error(err, 'Got an error, interrupted connection? ')\n                }\n            }\n        }\n    }\n\n    listenToChannels() {\n        // disabling no-loop-func because these loops are correct usage\n        // https://eslint.org/docs/rules/no-loop-func\n        // when a new channel is added, listen to it.\n        this.channelRef.on('child_added', ev => {\n            if (this.connections.length > this.MAX_CONNECTIONS) {\n                console.error(\n                    'Too many connections. TODO:close/remove old stale connections'\n                )\n                return\n            }\n            var val = ev.val()\n            if (this.debug) {\n                console.log(val, 'new child')\n            }\n            for (var i in val.fromClient) {\n                var sig = val.fromClient[i]\n                if (sig.type === 'offer') {\n                    var mykey = ev.key\n                    var { peerID, myID } = sig\n                    var channel = new Channel(\n                        this.channelRef.child(mykey),\n                        this._makePeer(myID)\n                    )\n                    this.connections = [...this.connections, channel]\n                    this.fire('addConnection', channel)\n\n                    // on message through webRTC (simple-peer)\n                    //eslint-disable-next-line no-loop-func\n                    var answerSentYet = false\n                    channel.peer.on('signal', data => {\n                        if (data.type === 'answer') {\n                            if (answerSentYet) {\n                                console.warn(\n                                    'Why am i trying to send multiple answers'\n                                )\n                            }\n                            channel.outRef.push(data)\n                            answerSentYet = true\n                        } else if (data.candidate) {\n                            channel.outRef.push(data)\n                        } else {\n                            console.warn(data, 'unexpected message from WebRTC')\n                        }\n                    })\n\n                    // on message through firebase\n                    //eslint-disable-next-line no-loop-func\n                    channel.inRef.on('child_added', ev2 => {\n                        var val2 = ev2.val()\n                        if (this.debug) {\n                            console.log(val2, 'child_added -- firebase')\n                        }\n                        if (val2.candidate) {\n                            if (this.debug) {\n                                console.log(\n                                    val2,\n                                    'server got candidate from firebase'\n                                )\n                            }\n                            channel.peer.signal(val2)\n                        } else if (val2.type === 'offer') {\n                            channel.peer.signal(val2)\n                        } else if (val2.type === 'answer') {\n                            //ignore this. It was probably from me.\n                        } else {\n                            console.warn(\n                                val2,\n                                'unexpected message from Firebase'\n                            )\n                        }\n                    })\n                }\n            }\n        })\n    }\n\n    _makePeer(peerID) {\n        if (this.debug) console.log('_makePeer called with peerID: ', peerID)\n        this.fire('makePeer', undefined)\n        var myoptions = {\n            initiator: false,\n            trickle: true,\n            config: {\n                iceServers: this.iceServers,\n            },\n            peerID,\n        }\n        if (this.stream) myoptions.stream = this.stream\n        var p = new PeerBinary(myoptions)\n        // fire events\n        p.on('error', err => {\n            console.error('server: error', err)\n            this.fire('error', { peer: p, err: err })\n        })\n        p.on('connect', () => {\n            if (this.debug) console.log('server: client connected')\n            this.fire('connect', { peer: p })\n        })\n        p.on('data', data => {\n            if (this.debug)\n                console.log('server: server recieved some data: ', data)\n            this.fire('data', { peer: p, data: data })\n        })\n        p.on('close', () => {\n            if (this.debug) console.log('server: connection closed', p)\n            this._removeConnection(p)\n            this.fire('close', { peer: p })\n        })\n        p.on('dataBig', data => {\n            this.fire('dataBig', { peer: p, data: data })\n        })\n        p.on('stream', stream => {\n            if (this.debug) console.log('Server: connected to stream', stream)\n            this.fire('stream', { peer: p, stream: stream })\n        })\n        p.on('signal', data => {\n            if (this.debug) console.log('Server: received signal', data)\n            this.fire('signal', data)\n        })\n        //TODO make it so server can register events that will get called on each individual connection\n        return p\n    }\n\n    destroy() {\n        this.channelRef.remove()\n        this.updateRef.remove()\n        this.channelRef.off()\n        this.updateRef.off()\n        this.userRef.off()\n        this.isListening = false\n        for (var x of this.connections) {\n            x.destroy()\n        }\n        this.fire('destroyed', {})\n        this.connections = []\n        clearInterval(this._intervalID)\n    }\n\n    _removeConnection(peer) {\n        var index = -1\n        for (var i = 0; i < this.connections.length; i++) {\n            var conn = this.connections[i]\n            if (conn.peer == peer) {\n                if (this.debug) console.log('found my connection', i, conn)\n                index = i\n            }\n        }\n        if (index >= 0) {\n            var conn = this.connections[index]\n            conn.destroy()\n            this.connections.splice(index, 1)\n            this.connections = [...this.connections]\n            this.fire('removeConnection', conn)\n            if (this.debug) console.log(this.connections)\n        }\n    }\n}\n","import { PeerBinary } from './PeerBinary.js'\nimport { settings } from './settings.js'\nimport { Evented } from './Evented.js'\nimport { getDatabase } from './defaultFirebase.js'\n\nexport class P2PClient extends Evented {\n    constructor(options = {}) {\n        super()\n        Object.assign(this, settings)\n        Object.assign(this, options)\n\n        this.iceServers =\n            options.iceServers || options.ICE_SERVERS || settings.ICE_SERVERS\n\n        if (options.database) {\n            this.database = options.database\n        } else {\n            this.database = getDatabase()\n        }\n\n        this.fbref = this.database\n        this.connection = null\n        this.channelRef = null\n        this.stream = undefined\n        this.isStream = true\n        this.connectionCallbacks = []\n        this.lastNegotiationState = undefined\n    }\n\n    getPeerList(callback) {\n        this.fbref.once('value', ev => {\n            var val = ev.val()\n            this.peerList = val\n            callback(null, val)\n        })\n    }\n\n    connectToPeerID(id, callback = () => {}) {\n        this.connectionCallbacks.push(callback)\n        this.getPeerList(() => {\n            var peer = this.peerList[id]\n            if (!peer) {\n                console.error('peer not defined. id:', id)\n                callback('peer not defined')\n            } else {\n                this.id = id\n                this.serverRef = this.fbref.child(id)\n                this.serverRef.once('value', ev1 => {\n                    var sval = ev1.val()\n                    let pOpts = {\n                        initiator: true,\n                        trickle: true,\n                        config: {\n                            iceServers: this.iceServers,\n                        },\n                    }\n\n                    if (sval.isStream || this.isStream) {\n                        pOpts.stream = this.getMyStream()\n                    }\n                    var p = new PeerBinary(pOpts)\n                    this.connection = p\n                    this._registerEvents()\n                    p.on('signal', data => {\n                        if (data.type == 'offer') {\n                            this._createChannel(data)\n                        } else if (data.candidate) {\n                            if (this.debug) {\n                                console.log(\n                                    'client recieved candidate from webrtc',\n                                    data\n                                )\n                            }\n                            this.outRef.push(data)\n                        } else {\n                            console.warn(\n                                'Client recieved unexpected signal through WebRTC:',\n                                data\n                            )\n                        }\n                    })\n                    callback(null, this.connection)\n                })\n            }\n        })\n    }\n\n    getMyStream() {\n        if (this.stream) return this.stream\n\n        // create fake stream if no stream specified, and the server is in streaming mode.\n        //    because, at the moment, simple-peer must have a stream from the initiator.\n        let fakeCanvas = document.createElement('canvas')\n        fakeCanvas.width = fakeCanvas.height = 1\n        var fakeStream = fakeCanvas.captureStream()\n        return fakeStream\n    }\n\n    disconnect(callback) {\n        callback =\n            callback ||\n            function() {\n                console.log('client disconnected from server', arguments)\n            }\n\n        if (this.serverRef) {\n            this.serverRef.off()\n        }\n        if (this.outRef) {\n            this.outRef.off()\n        }\n        if (this.inRef) {\n            this.inRef.off()\n        }\n        if (this.connection) {\n            this.connection.destroy(callback)\n        } else {\n            callback()\n        }\n        // QUESTION: should I also disconnect from the listeners to the events emitted by this class?\n        //     it would be this.off()\n    }\n\n    _createChannel(offer) {\n        //this.channelRef = this.serverRef.child('channels').push({offer:offer})\n        offer.peerID = this.peerID\n        offer.myID = this.myID\n        this.channelRef = this.serverRef.child('channels').push({\n            fromClient: [offer],\n        })\n        this.outRef = this.channelRef.child('fromClient')\n        this.inRef = this.channelRef.child('fromServer')\n        this.inRef.on('child_added', ev => {\n            if (this.debug) console.log(ev.val(), 'channel message, client')\n            var val = ev.val()\n            if (val.type === 'answer') {\n                setTimeout(() => {\n                    let state = this.connection._pc.signalingState\n                    if (state == this.lastNegotiationState) {\n                        if (this.debug)\n                            console.log('signalstate. skip nested negotiations')\n                        return\n                    }\n                    if (this.debug) console.log('signal start negotiation')\n                    this.lastNegotiationState = state\n                    if (this.debug) console.log('answer', this)\n                    if (!this.connection.destroyed) this.connection.signal(val)\n                }, 50) // a slight delay helps establish connection, I think.\n            } else if (val.candidate) {\n                if (this.debug)\n                    console.log('client recieved candidate from firebase')\n                setTimeout(() => {\n                    if (!this.connection.destroyed) this.connection.signal(val)\n                }, 50)\n            } else {\n                console.warn(\n                    val,\n                    'Client recieved unexpected signal through Firebase'\n                )\n            }\n        })\n    }\n\n    _registerEvents() {\n        // fire events\n        this.connection.on('error', err => {\n            console.error('client: error', err)\n            this.fire('error', { peer: this.connection, err: err })\n        })\n        this.connection.on('connect', () => {\n            if (this.debug) console.log('client: client connected')\n            try {\n                for (var callback of this.connectionCallbacks) {\n                    callback(null, this.connection)\n                }\n                this.connectionCallbacks = []\n            } catch (err) {\n                console.warn(err)\n            }\n            this.fire('connect', { peer: this.connection })\n        })\n        this.connection.on('data', data => {\n            if (this.debug) console.log('client: recieved some data: ', data)\n            this.fire('data', { peer: this.connection, data: data })\n        })\n        this.connection.on('close', data => {\n            if (this.debug) console.log('connection closed', this.connection)\n            this.fire('close', { peer: this.connection })\n        })\n        this.connection.on('dataBig', data => {\n            this.fire('dataBig', { peer: this.connection, data: data })\n        })\n        this.connection.on('stream', stream => {\n            if (this.debug) console.log('Client: connected to stream', stream)\n            this.fire('stream', { peer: this.connection, stream: stream })\n        })\n        this.connection._pc.addEventListener('signalingstatechange', () => {\n            console.log('signalState', this.connection._pc.signalingState)\n        })\n    }\n}\n","import * as Peer2 from 'simple-peer/simplepeer.min.js'\nimport { generateWebRTCpayload, recursivelyDecodeBlobs } from './dataUtils.js'\n// import adapter from \"webrtc-adapter/src/js/adapter_core.js\";\nimport * as msgpacklite from 'msgpack-lite/dist/msgpack.min.js'\n\nconst msgPack = msgpacklite.default\nconst Peer = Peer2.default\nwindow.simpPeer = Peer\n\nconst sleep = milliseconds => {\n    return new Promise(resolve => setTimeout(resolve, milliseconds))\n}\n\nexport class PeerBinary extends Peer {\n    constructor(options) {\n        //console.log('PeerBinary contructor called')\n        super(options)\n        this._registerDataMessage()\n        this.unchunker = new UnChunker() //\n        this.unchunker.onData = val => {\n            this.emit('dataBig', val)\n        }\n        this.peerID = options.peerID\n    }\n\n    //want to overide these 2 functions I think.\n    _registerDataMessage(event) {\n        this.on('data', data => {\n            //when its done with a complete chunk, call this.emit('dataBig', completed)\n            this.unchunker.registerChunk(data)\n        })\n    }\n\n    async sendBig(chunk) {\n        let stuff = await generateWebRTCpayload(chunk)\n        this.send(stuff.header)\n        for (var i in stuff.chunks) {\n            var ch = stuff.chunks[i]\n            this.send(ch)\n            await sleep(60) //give the other side time to handle message\n        }\n    }\n}\n\n//\n// Takes a bunch of possibly out of order shunks and assembles them into one\n//\nexport class UnChunker {\n    constructor() {\n        this.payloads = {}\n        this.payloadCount = 0\n        this.onData = function(val) {\n            console.log('default, data is ready:', val)\n        }\n    }\n\n    registerChunk(msg) {\n        var header = this.parseHeader(msg)\n        if (header) {\n            this._newPayload(header.payloadID, header)\n        } else if (this._isChunk(msg)) {\n            //the is a chunk hopefully\n            try {\n                let val = msgPack.decode(msg)\n                this._appendToPayload(val)\n                //this.emit('dataBig', val)\n                if (this._isPayloadReady(val.payloadID)) {\n                    this._assembleChunks(val.payloadID, result => {\n                        this.onData(result)\n                        return result\n                    })\n                }\n            } catch (err) {\n                console.error(err)\n                console.error('val:', msg)\n            }\n        } else {\n            console.warn('not my type', msg)\n            //console.warn(this._ab2str(msg))\n        }\n        return null\n    }\n\n    _newPayload(id, header) {\n        this.payloads[id] = Object.assign(header, {\n            count: header.chunkCount,\n            chunks: [],\n            lastUpdate: new Date(),\n        })\n        this.payloadCount++\n    }\n\n    _appendToPayload(chunk) {\n        var pl = this.payloads[chunk.payloadID]\n        pl.lastUpdate = new Date()\n        pl.chunks.push(chunk)\n    }\n\n    async _assembleChunks(payloadID, cb) {\n        var pl = this.payloads[payloadID]\n        pl.chunks.sort(function(a, b) {\n            return Number(a.id) - Number(b.id)\n        })\n        var totalSize = 0\n        for (var i = 0; i < pl.chunks.length; i++) {\n            totalSize += pl.chunks[i].chunk.length\n        }\n        var result = new Uint8Array(totalSize)\n        var position = 0\n        for (var i = 0; i < pl.chunks.length; i++) {\n            var ch = pl.chunks[i]\n            result.set(ch.chunk, position)\n            position += ch.chunk.length\n        }\n        try {\n            let val1 = msgPack.decode(result)\n            let val2 = await recursivelyDecodeBlobs(val1)\n            cb(val2)\n            this._removePayload(payloadID)\n        } catch (err) {\n            console.error(err)\n            console.error('buffer', result)\n        }\n    }\n\n    _removePayload(id) {\n        delete this.payloads[id]\n        this.payloadCount--\n    }\n\n    parseHeader(data) {\n        if (typeof data == 'object' && !(data instanceof Uint8Array)) {\n            if (data.chunkCount && data.chunkCount > 0) {\n                return data\n            }\n        } else if (data.length && data.length < 4000) {\n            // might have been packed or something.\n            var json = msgPack.decode(data)\n            if (json) {\n                try {\n                    if (json && json.iAmAHeader) {\n                        return json\n                    }\n                } catch (er) {\n                    // probably not a header. Not a big deal\n                }\n            }\n        }\n        return undefined\n    }\n\n    _isChunk(msg) {\n        if (this.payloadCount <= 0) {\n            return false\n        }\n        return msg instanceof Uint8Array || msg instanceof DataView\n    }\n\n    _isPayloadReady(id) {\n        var pl = this.payloads[id]\n        if (pl.chunks.length == pl.count) {\n            return true\n        }\n        return false\n    }\n}\n"],"names":["msgpacklite.default","msgPack","Peer2.default","firebase2.default","firebase","Peer","sleep","PeerBinary","UnChunker"],"mappings":"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"}